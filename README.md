# :ledger: Веб-приложение metacognitive-therapy.ru
![anim](https://github.com/user-attachments/assets/bb64c864-7842-4b61-8f50-9cea6c72ef11)  
Веб-приложение [metacognitive-therapy.ru](https://metacognitive-therapy.ru) - это уникальный онлайн-ресурс, созданный для тех, кто хочет **абсолютно бесплатно** получить знания, умения и навыки по соврменной когнитивной-поведенческий психотерапии 3 волны - метакогнитивной тепарии, разработанной профессором Манчестерского университета Эдрианом Уэллсом.  
  
**Миссия сайта:**  
На основе материалов сайта Вы сможете самостоятельно проработать свои психологические проблемы. Но если у Вас будет что-то не получаться Вы всегда можете через сайт записаться на индивидуальную консультацию к опытному метакогнитивному психотерапевту.  
  
**Что предлагает сайт:**  
- Узнайте **последние новости** из мира психотерапии
- Изучите **новые статьи о новейших исследованиях** в области психиатрии и психотерапии
- Изучите **новейший учебник метакогнитивной психотерапии**, включающий следующие разделы:
  - Международная классификация болезней 11 пересмотра
  - Современная психофармакология
  - Немедикаментозные методы лечения психических расстройств
  - Метакогнитивная терапия
- **Задать любой вопрос** на сайте, даже если вы не зарегистрированы и получить ответ от психотерапевта
- **Записаться на индивидуальную консультацию**, если у Вас что-то не получается в процессе проработки психологических проблем
- **Зарегистрироваться** на сайте **через самые популярные социальные сети**: ВКонтакте (VK), Одноклассники, через сервисы Google или Яндекс, а также через месседжер Telegram **в один клик**.
- Регистрация позволяет:
  - Отмечать, какие статьи и главы учебника вы изучили. Изученные главы и статьи будут **отображаться в статистике** в Вашем личном кабинете.
  - В личном кабинете вы можете вести **дневник состояний**, который будет **доступен только Вам**. Если Вы брали индивидуальную консультацию **Ваш дневник будет анализировать Ваш психотерапевт** и давать рекомендации по лечению.

## :mortar_board: Технологии
### Основные технологии
:green_book: Python 3.12  
:green_book: Flask 3  
:green_book: HTML, CSS, Bootsrap  
:green_book: JavaScript (ES6)  
:green_book: Адаптивная вёрстка  
:green_book: SQLAlchemy 2.0  
:green_book: PostgreSQL (production)  
:green_book: SQLite (testing)  
:green_book: Elasticsearch  
:green_book: Регулярные выражения RegExp  
:green_book: WYSIWYG-редактор  
:green_book: Redis (cache server, message broker)  
:green_book: Celery  
:green_book: Pytest  
:green_book: OAuth 2.0 (Google, VK, Одноклассники, Яндекс, Telegram)  
:green_book: Google reCAPTCHA  
:green_book: Poetry  
:green_book: Логирование  
:green_book: Docker  
:green_book: (*В production*) Gunicorn  
:green_book: (*В production*) CI/CD (GitHub Actions)  
:green_book: (*В production*) nginx

### Дополнения для Flask
:blue_book: flask-migrate  
:blue_book: flask-wtf  
:blue_book: flask-login  
:blue_book: flask-mailman  
:blue_book: flask-admin  
:blue_book: flask-ckeditor  
:blue_book: flask-debugtoolbar  
:blue_book: flask-caching  

### Дополнительные библиотеки
:orange_book: python-dotenv  
:orange_book: phonenumbers  
:orange_book: email-validator  
:orange_book: requests  
:orange_book: pyopenssl  
:orange_book: itsdangerous  
:orange_book: pillow  
:orange_book: mimesis  
:orange_book: psycopg2-binary

## :page_facing_up: Руководство по OAuth 2.0
В связи с тем, что авторизация через социальные сети Google, VK, Одноклассники, Яндекс и Telegram - это очень объёмная тема, я составил подробнейшее руководство по авторизации через эти сервисы. В данном руководстве я шаг за шагом объясняю, как реализовать OAuth 2.0, иллюстрируя каждый шаг.
 Сайт        | Ссылка           | 
| ------------- |:-------------:|
| ![yandex](https://github.com/IvanZaycev0717/python_interview_assistant_rus/assets/111955306/df5ff781-7cdd-4be5-9359-113b3706324e)| [PDF-файл "Руководство по OAuth 2.0"](https://disk.yandex.ru/i/YGXCyFmgACyr5Q)|

Также данное PDF-руководство доступно в корневой папке репозитория

## :lock: Защиты сайта
Сайт является полностью безопасным и был протестирован различными методами: от мануального тестирования до автотестов, **написанных на pytest**.
|Защита от:|Описание|
|----------|---------|
|XSS-атак|Шаблоны Jinja2, используемые в Flask, автоматически экранируют выводимые данные, что предотвращает выполнение вредоносного JavaScript-кода.|
|CSRF-атак|Включена защита от межсайтовых запросов (CSRF) с помощью расширения `Flask-WTF`, которое автоматически добавляет CSRF-токены в формы.|
|SQL-инъекций|Все запросы в базу данных являются параметризированными. Все входные данные тщательно проверяются и очищаются, чтобы предотвратить SQL-инъекции и другие атаки, связанные с некорректными данными.|
|Защита от спама|Используется самая последняя версия reCAPTCHA 3 от Goggle|
|Незашифрованные данные|Все соединения с сайтом защищены с помощью HTTPS, что обеспечивает шифрование данных между клиентом и сервером|
|Кража данных сессии|Используется безопасное управление сессиями, что включает шифрование данных сессии и настройку таймаутов|
|DDoS-атаки|Осуществляется на уровне хостинга|
|Пользователи, нарушающие законодательство РФ|Сайтом предусмотрена блокировка пользователя по IP-адресу|

## :rocket: Оптимизация сайта
Для работы сайта была произведена минимизация времени отклика для пользователя с помощью следующих действий:  
1. Выбор **правильной схемы базы данных** для минимизации запросов
2. Использование самых **ограничительных критериев для фильтрации** данных при выполнении запроса
3. **Индексация полей**, где используются операторы WHERE, ORDER BY, JOIN
4. Выбор **PostgreSQL 16** с эффективным оптимизатором запросов, выбирающий план выполнения с наименьшей стоимостью запроса
5. Минимизация запросов с помощью Flask Debug Toolbar - там, где возможно, "ленивая" загрузка (**lazy loading**) была заменена на "жадную" загрузку (**eager loading**)
6. Кеширование страниц и возвращаемых данных функций с помощью **NoSQL СУБД Redis**
7. При отправке письма происходит обход глобальной блокировки интерпритатора Python (**GIL**) с помощью использования брокера сообщений Redis и **асинхронной очереди Celery**
8. Для полнотекстового поиска использована технология **Elasticsearch**, которая позволяет не сканировать полностью базу данных сайта.
9. (*В production*) Использована **многопроцессность** для WSGI-сервера gunicorn  
10. (*В production*) Произведена **тонкая настройка сервера nginx**

## :newspaper: ER-диаграмма базы данных
В результате анализа требований и структуры данных, была выбрана наиболее оптимальная ER-диаграмма, которая обеспечивает эффективное взаимодействие между сущностями. Этот подход позволяет минимизировать избыточность данных и улучшить производительность запросов в базе данных.
![er](https://github.com/user-attachments/assets/c206ccb8-9697-49d3-9c16-265abffdead0)

## :computer: Запуск на локальном компьютере
В данном репозитории представлена **публичная версия сайта для ознакомления с основными возможностями**. Все данные представленные в файле .env.example **являются публичными и не представляют никакой тайны**.  
  

*В production используется приватная версия сайта со своим файлом .env, в котором содержатся секретные данные. Приватная версия сайта доступна только создателю сайта и находится в специальном приватном репозитории.*

### :whale: Установка с помощью Docker
1. **Установите и запустите Docker engine на вашем компьюетере**  

2. **Убедитесь, что Docker engine запущен**  
```
docker info
```   
3. **Клонируйте репозиторий на локальный компьютер по SSH-протоколу**
```
git clone git@github.com:IvanZaycev0717/mct-flask-sqlalchemy-redis.git
```
**Если у вас нет ключа SSH, то скачайте с GitHub архив в формате zip.**
```
https://github.com/IvanZaycev0717/mct-flask-sqlalchemy-redis/archive/refs/heads/main.zip
```
Распакуйте в выбранную директорию этот архив.  


4. **Перейдите в директорию с проектом на своей локальном компьютере**
```
cd <путь к директории с проектом>
```

5. **Переименуйте .env.example в .env**

6. **Откройте файл .env и измените электронную почту администратора на свою:**
```
# Secrets
ADMIN_EMAIL=your-email-address@you-domain.com
```
**Далее, если требуется, установите свои параметры конфигурации Redis**
```
# Redis setup
BROKER_URL=redis://redis:6379
RESULT_BACKEND=redis://redis:6379
REDIS_URL=redis://redis:6379
REDIS_PASSWORD=your_redis_password
```
**Сохраните этот файл**    

7. **Выполнитете команду создания и запуска контейнеров в фоновом режиме**
```
docker compose up -d
```
**Дождитесь пока база данных будет создана и в логах контейнера mct-app будут пройдены все тесты**  
  

8. **Откройте браузер и перейдите на адрес**
```
https://127.0.0.1/
```
9. **Обойдите предупреждение "Подключение не защищено" перейдя в "Дополнительно" и открыть сайт.**
10. **Можете начинать пользоваться сайтом от имени администратора**
- **Имя пользователя**: admin
- **Пароль**: 1234

## 🧙 Автор
**Иван Зайцев**,  
Full Stack Developer (Python Backend Developer + Frontend Developer)  
©2024







